angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$translate","$log","realTimeService","randomService","resizeGameAreaService",function(a,b,c,d,e){"use strict";function f(a){for(var b=0;b<C.length;b++){var c=new Date;if(C[b].finished<c.getTime()){C[b].finished=c.getTime()+1e3*a.duration,C[b].channel.src=a.src,C[b].channel.load(),C[b].channel.play();break}}}function g(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function h(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toGMTString();document.cookie=a+"="+b+"; "+e}function i(a){var b={WIDTH:320,HEIGHT:480,scale:1,offset:{top:0,left:0},entities:[],currentPlayerIndex:a,currentWidth:null,currentHeight:null,canvas:null,ctx:null,score:{taps:0,coins:0},distance:0,digits:[],fonts:[],RATIO:null,bg_grad:"day",game:null,ua:null,android:null,ios:null,gradients:{},init:function(a,c){console.log("in init"),b.currentPlayerIndex=c;var d;b.RATIO=b.WIDTH/b.HEIGHT,b.currentWidth=b.WIDTH,b.currentHeight=b.HEIGHT,b.canvas=a,b.canvas.width=b.WIDTH,b.canvas.height=b.HEIGHT,b.ctx=b.canvas.getContext("2d"),b.ua=navigator.userAgent.toLowerCase(),b.android=b.ua.indexOf("android")>-1?!0:!1,b.ios=b.ua.indexOf("iphone")>-1||b.ua.indexOf("ipad")>-1?!0:!1,d=b.ctx.createLinearGradient(0,0,0,b.HEIGHT),d.addColorStop(0,"#036"),d.addColorStop(.5,"#69a"),d.addColorStop(1,"yellow"),b.gradients.dawn=d,d=b.ctx.createLinearGradient(0,0,0,b.HEIGHT),d.addColorStop(0,"#69a"),d.addColorStop(.5,"#9cd"),d.addColorStop(1,"#fff"),b.gradients.day=d,d=b.ctx.createLinearGradient(0,0,0,b.HEIGHT),d.addColorStop(0,"#036"),d.addColorStop(.3,"#69a"),d.addColorStop(1,"pink"),b.gradients.dusk=d,d=b.ctx.createLinearGradient(0,0,0,b.HEIGHT),d.addColorStop(0,"#036"),d.addColorStop(1,"black"),b.gradients.night=d,b.canvas.addEventListener("click",function(a){a.preventDefault(),b.Input.set(a)},!1),b.canvas.addEventListener("touchstart",function(a){a.preventDefault(),console.log("touch=",a.touches[0]),b.Input.set(a.touches[0])},!1),b.canvas.addEventListener("touchmove",function(a){a.preventDefault()},!1),b.canvas.addEventListener("touchend",function(a){a.preventDefault()},!1),b.changeState("Splash"),b.loop()},update:function(){b.game.update(),b.Input.tapped=!1},render:function(){b.Draw.rect(0,0,b.WIDTH,b.HEIGHT,b.gradients[b.bg_grad]);for(var a=0;a<b.entities.length;a+=1)"bird"!=b.entities[a].type&&b.entities[a].render();b.game.render()},loop:function(){isGameOngoing&&(b.update(),b.render())},changeState:function(a){b.game=new window[a](b),b.game.init()}};return b.Draw={clear:function(){b.ctx.clearRect(0,0,b.WIDTH,b.HEIGHT)},rect:function(a,c,d,e,f){b.ctx.fillStyle=f,b.ctx.fillRect(a,c,d,e)},circle:function(a,c,d,e){b.ctx.fillStyle=e,b.ctx.beginPath(),b.ctx.arc(a+5,c+5,d,0,2*Math.PI,!0),b.ctx.closePath(),b.ctx.fill()},Image:function(a,c,d){b.ctx.drawImage(a,c,d)},Sprite:function(a,c,d,e,f,g,h,i,j,k){b.ctx.save(),b.ctx.translate(g,h),b.ctx.rotate(k*(Math.PI/180)),b.ctx.translate(-(g+i/2),-(h+j/2)),b.ctx.drawImage(a,c,d,e,f,g,h,i,j),b.ctx.restore()},semiCircle:function(a,c,d,e){b.ctx.fillStyle=e,b.ctx.beginPath(),b.ctx.arc(a,c,d,0,Math.PI,!1),b.ctx.closePath(),b.ctx.fill()},text:function(a,c,d,e,f){b.ctx.font="bold "+e+"px Monospace",b.ctx.fillStyle=f,b.ctx.fillText(a,c,d)}},b.Input={x:0,y:0,tapped:!1,set:function(a){this.x=(a.pageX-b.offset.left)/b.scale,this.y=(a.pageY-b.offset.top)/b.scale,this.tapped=!0}},b.Cloud=function(a,c){this.x=a,this.y=c,this.r=30,this.col="rgba(255,255,255,1)",this.type="cloud",this.vx=-.1,this.remove=!1,this.update=function(){this.x+=this.vx,this.x<-115&&this.respawn()},this.render=function(){b.Draw.circle(this.x+this.r,this.y+this.r,this.r,this.col),b.Draw.circle(this.x+55,this.y+this.r/2,this.r/.88,this.col),b.Draw.circle(this.x+55,this.y+this.r+15,this.r,this.col),b.Draw.circle(this.x+85,this.y+this.r,this.r,this.col)},this.respawn=function(){this.x=~~(d.random(a)*this.r*2)+b.WIDTH,this.y=~~(d.random(c)*b.HEIGHT/2)}},b.BottomBar=function(a,c,d){this.x=a,this.y=c,this.r=d,this.vx=-1,this.name="BottomBar",this.update=function(){this.x+=this.vx,this.x<0-this.r&&this.respawn()},this.render=function(){b.Draw.rect(this.x,this.y,this.r,100,"#D2691E");for(var a=0;10>a;a++)b.Draw.semiCircle(this.x+a*(this.r/9),this.y,20,"#050")},this.respawn=function(){this.x=b.WIDTH-1}},b.Tree=function(a,c){this.x=a,this.y=c,this.r=30,this.h=50,this.w=2*this.r,this.vx=-1,this.type="Tree",this.update=function(){this.x+=this.vx,this.x<0-2*this.r&&this.respawn()},this.render=function(){b.Draw.circle(this.x+this.r,this.y+this.r-10,this.r,"green","#050"),b.Draw.circle(this.x+this.r/2,this.y+this.r-10,this.r/3,"rgba(0,0,0,0.08)"),b.Draw.rect(this.x+this.r,this.y+this.r,10,this.r,"brown","#d20")},this.respawn=function(){this.x=b.WIDTH+this.r}},b.Pipe=function(a,c){this.centerX=a,this.coin=!0,this.w=c,this.h=b.HEIGHT-150,this.vx=-1,this.type="pipe",this.update=function(){this.centerX+=this.vx,this.centerX==0-this.w&&this.respawn()},this.render=function(){this.coin&&b.Draw.circle(this.centerX+this.w/2-5,this.centerY-5,5,"Gold"),b.Draw.rect(this.centerX,0,this.w,this.centerY-50,"#8ED6FF"),b.Draw.rect(this.centerX,this.centerY+50,this.w,this.h-this.centerY,"#8ED6FF")},this.respawn=function(){this.centerY=this.randomIntFromInterval(70,220),this.centerX=320-this.w+160,this.coin=!0},this.randomIntFromInterval=function(b,c){return d.randomFromTo(a,b,c)},this.centerY=this.randomIntFromInterval(70,220)},b.Bird=function(a){this.img=new Image,this.img.src=w[a],this.gravity=.25,this.width=34,this.height=24,this.ix=0,this.iy=0,this.fr=0,this.vy=180,this.vx=70,this.velocity=0,this.play=!1,this.jump=-4.6,this.rotation=0,this.type="bird",this.playerIndex=a,this.update=function(){this.fr++>5&&(this.fr=0,this.iy==3*this.height&&(this.iy=0),this.iy+=this.height),this.play&&(this.velocity+=this.gravity,this.vy+=this.velocity,this.vy<=0&&(this.vy=0),this.vy>=370&&(this.vy=370),this.rotation=Math.min(this.velocity/10*90,90)),b.Input.tapped&&(this.play=!0,f(x),this.velocity=this.jump)},this.render=function(){b.Draw.Sprite(this.img,this.ix,this.iy,this.width,this.height,this.vx,this.vy,this.width,this.height,this.rotation)}},b.Particle=function(a,c,e,f,g){this.x=a,this.y=c,this.r=e,this.col=f,this.type=g||"circle",this.name="particle",this.dir=2*d.random(a)>1?1:-1,this.vx=~~(4*d.random(a))*this.dir,this.vy=~~(7*d.random(c)),this.remove=!1,this.update=function(){this.x+=this.vx,this.y-=this.vy,this.vx*=.99,this.vy*=.99,this.vy-=.35,this.y>b.HEIGHT&&(this.remove=!0)},this.render=function(){"star"===this.type?b.Draw.star(this.x,this.y,this.col):b.Draw.circle(this.x,this.y,this.r,this.col)}},b.Collides=function(a,c){if(a.vy>=370)return!0;c.coin&&a.vx>c.centerX+c.w/2-5&&(c.coin=!1,l[b.currentPlayerIndex]+=1,b.score.coins+=1,b.digits=b.score.coins.toString().split(""),f(y));var d=a.vx-a.width/2,e=a.vy-a.height/2,g=a.vx+a.width/2,h=a.vy+a.height/2,i=c.centerX,j=0,k=c.centerX+c.w,m=c.centerY-50,n=c.centerX,o=c.centerY+50,p=k,q=c.h,r=!(d>k||i>g||e>m||j>h),s=!(d>p||n>g||e>q||o>h);return r||s},b}function j(c){function j(a){l=[],t=!0,H=a.yourPlayerIndex,p=a.playersInfo,console.log("playersInfo=",p.length),o=a.matchController,isGameOngoing=!0,I=1===p.length,I=1===p.length?!0:!1,k=(new Date).getTime(),b.info("gotStartMatch:",a),e.setWidthToHeight(.5),F=i(H),r[H]=F;for(var d=0;d<r[H].entities.length;d++)"bird"!==r[H].entities[d].type||C(s,r[H].entities[d])||s.push(r[H].entities[d]);for(var d=0;d<p.length;d++)l[d]=0;q?(F.init(c,H),setTimeout(function(){F.changeState("Play"),F.Input.tapped=!1,D()},2e3)):(setTimeout(function(){F.init(c,H)},2e3),setTimeout(function(){F.changeState("Play"),F.Input.tapped=!1,D()},5e3))}function w(){return r[H]}function x(a){if(I=1===p.length,!I&&isGameOngoing){for(var b=w(),c=[],d=0,e=b.entities.length-1,f=e-p.length;e>f;e--)c[d]=b.entities[e],d++;for(var g=[],e=0;e<c.length;e++)if(c[e].playerIndex===H){g.push({gravity:c[e].gravity,width:c[e].width,height:c[e].height,ix:c[e].ix,iy:c[e].iy,fr:c[e].fr,vy:c[e].vy,velocity:c[e].velocity,play:c[e].play,jump:c[e].jump,rotation:c[e].rotation,type:c[e].type,playerIndex:c[e].playerIndex});break}if(b){var h=angular.toJson({fb:g,s:l[H]});a?o.sendReliableMessage(h):o.sendUnreliableMessage(h)}}}function y(a){var b=w(),c=a.fromPlayerIndex,d=a.message;if("{}"!=d){var e=angular.fromJson(d);l[c]=e.s;for(var f,g=(e.fb[0],b.entities.length-1),h=g-p.length;g>h;g--)if("bird"==b.entities[g].type&&b.entities[g].playerIndex===c){f=g;break}if(b.entities.length<9)return;for(var g=0;g<s.length;g++)if(s[g].playerIndex===b.entities[f].playerIndex){s[g]=b.entities[f];break}}}function B(a){F.changeState("GameOver"),l=a,isGameOngoing=!1}function C(a,b){for(var c=0;c<a.length;c++)if(a[c].playerIndex===b.playerIndex)return!0;return!1}function D(){E(),G=setInterval(F.loop,1e3/60)}function E(){clearInterval(G)}window.isGameOngoing=!1;var F,G,H=-1,I=!1;return window.Splash=function(b){this.banner=new Image,this.banner.src="imgs/splash.png",this.init=function(){f(A),b.distance=0,b.bg_grad="day",b.entities=[],b.score.taps=b.score.coins=0,b.entities.push(new b.Cloud(30,~~(d.random(u)*b.HEIGHT/2))),b.entities.push(new b.Cloud(130,~~(d.random(u)*b.HEIGHT/2))),b.entities.push(new b.Cloud(230,~~(d.random(u)*b.HEIGHT/2)));for(var a=0;2>a;a+=1)b.entities.push(new b.BottomBar(b.WIDTH*a,b.HEIGHT-100,b.WIDTH));b.entities.push(new b.Tree(~~(d.random(u)*b.WIDTH),b.HEIGHT-160)),b.entities.push(new b.Tree(~~(d.random(u)*b.WIDTH+50),b.HEIGHT-160)),b.entities.push(new b.Tree(~~(d.random(u)*b.WIDTH+100),b.HEIGHT-160))},this.update=function(){for(var a=0;a<b.entities.length;a+=1)b.entities[a].update();b.Input.tapped&&(b.Input.tapped=!1)},this.render=function(){var c=new FPSMeter(document.body);c.tick();var d=Math.floor(((new Date).getTime()-k)/1e3);if(b.Draw.Image(this.banner,66,100),6>d){var e=4-d,f=v[b.currentPlayerIndex],g=a("YOUR_BIRD_COLOR_IS",{color:a(f.toUpperCase())});b.Draw.text(g,m/4-60,n/4-30,20,f),b.Draw.text(""+e,m/2,n/2-40,40,f)}}},window.Play=function(a){this.init=function(){console.log("started playing"),a.entities.push(new a.Pipe(2*a.WIDTH,50)),a.entities.push(new a.Pipe(2*a.WIDTH+a.WIDTH/2,50)),a.entities.push(new a.Pipe(3*a.WIDTH,50)),a.bird=[],-1==H&&(H=0);for(var b=0;b<p.length;b++)console.log("andar"),b!=H&&(a.bird[b]=new a.Bird(b),a.entities.push(a.bird[b]),C(s,a.bird[b])||s.push(a.bird[b]));a.bird[H]=new a.Bird(H),a.entities.push(a.bird[H]),C(s,a.bird[H])||s.push(a.bird[H]);for(var c=0;10>c;c++){var d=new Image;d.src="imgs/font_small_"+c+".png",a.fonts.push(d)}a.digits=["0"]},this.update1=function(){for(var b=0,c=a.entities.length-1,d=c-p.length;c>d;c--)if(a.entities[c].playerIndex!=a.currentPlayerIndex)for(var b=0;b<s.length;b++)if(a.entities[c].playerIndex===s[b].playerIndex){a.entities[c]=s[b];break}for(var c=0;c<a.entities.length;c+=1)if("bird"===a.entities[c].type&&a.entities[c].playerIndex!=a.currentPlayerIndex)for(var b=0;b<s.length;b++)if(a.entities[c].playerIndex===s[b].playerIndex){a.entities[c]=s[b];break}},this.update=function(){a.distance+=1;var b=a.distance%2048===0?!0:!1;if(b){for(var c="day",d=["day","dusk","night","dawn"],e=0;e<d.length;e++)a.bg_grad===d[e]&&(c=e==d.length-1?"day":d[e+1]);a.bg_grad=c}var f=!1;a.Input.tapped&&(a.score.taps+=1,f=!0);var g;for(e=0;e<a.entities.length;e+=1)if("bird"!=a.entities[e].type?a.entities[e].update():a.entities[e].playerIndex!=a.currentPlayerIndex||(g=a.entities[e]),"pipe"===a.entities[e].type)for(var h=0;h<p.length;h++){var i=a.Collides(a.bird[h],a.entities[e]);if(i){a.changeState("GameOver"),o.endMatch(l);break}}g.update(),x(!1)};this.render=function(){var b;for(d=0;d<a.entities.length;d+=1)"bird"===a.entities[d].type&&(a.entities[d].playerIndex!=a.currentPlayerIndex?a.entities[d].render():b=a.entities[d]);b.render();for(var c=a.WIDTH/2-14*a.digits.length/2,d=0;d<a.digits.length;d++)a.Draw.Image(a.fonts[Number(a.digits[d])],c+14*d,10)}},window.GameOver=function(b){var c=b.score.coins;this.getMedal=function(){var a;return console.log("score=",c),10>=c&&(a="bronze"),c>=20&&(a="silver"),c>=30&&(a="gold"),c>=40&&(a="platinum"),a},this.getHighScore=function(){var a=g("highscore");if(""!=a){var c=parseInt(a)||0;return c<b.score.coins&&(c=b.score.coins,h("highscore",c,999)),c}return h("highscore",b.score.coins,999),b.score.coins},this.init=function(){var c=this;setTimeout(function(){var d=v[0],e=a("COLOR_SCORE_IS",{color:a(d.toUpperCase()),score:""+c.getHighScore()});f(z),c.banner=new Image,c.banner.src="imgs/scoreboard.png";var g=c.getMedal();c.medal=new Image,c.medal.src="imgs/medal_"+g+".png",c.highscore=c.getHighScore(),b.Draw.text(e,m/4-60,n/4-30,30,d)},500)},this.update=function(){if(b.Input.tapped){var a=b.Input.x,c=b.Input.y;a>=102.5&&217.5>=a&&c>=260&&330>=c&&b.changeState("Splash"),b.Input.tapped=!1}},this.render=function(){this.banner&&(b.Draw.Image(this.banner,42,70),b.Draw.Image(this.medal,75,183),b.Draw.text(b.score.coins,220,185,15,"black"),b.Draw.text(this.highscore,220,225,15,"black")),setTimeout(function(){},0)}},{gotStartMatch:j,gotMessage:y,gotEndMatch:B}}var k,l,m=300,n=300,o=null,p=[],q=!0,r=[],s=[],t=!1,u=1,v=["blue","red","brown","purple","pink","yellow","orange","silver"],w=["imgs/bird_blue.png","imgs/bird_red.png","imgs/bird_brown.png","imgs/bird_purple.png","imgs/bird_pink.png","imgs/bird_yellow.png","imgs/bird_orange.png","imgs/bird_silver.png"];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3)}}();for(var x=new Audio("audio/wing.ogg"),y=new Audio("audio/point.ogg"),z=(new Audio("audio/hit.ogg"),new Audio("audio/die.ogg")),A=new Audio("audio/swooshing.ogg"),B=10,C=new Array,D=0;B>D;D++)C[D]=new Array,C[D].channel=new Audio,C[D].finished=-1;c.init({createCanvasController:j,canvasWidth:m,canvasHeight:n}),e.setWidthToHeight(.5)}]);
//# sourceMappingURL=everything.min.js.map